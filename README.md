---
title: "Generate image tags from Imagga and save tags to a database on ElephantSQL"
author: "Data Smart"
output:
  html_document:
    css: style.css
---


## About

In this video we will do a sequence of steps in Python to save image tags generated by Imagga Computer Vision API to a cloud database on ElephantSQL. 

We will use the code in below previous videos and string it together here. 

<div class="row">
  <div class="column">
    <img src="images/vd1.png" style="width:100%">
  </div>
  <div class="column">
    <img src="images/vd2.png" style="width:100%">
  </div>
  <div class="column">
    <img src="images/vd3.png" style="width:100%">
  </div>
</div>

<a href="https://youtu.be/xcXN7Vaq2gA" target="_blank"><img src="images/vd1.png" style="float: left; width: 30%; margin-right: 1%; margin-bottom: 0.5em;"></a><a href="https://youtu.be/TMFTQzePDvQ" target="_blank"><img src="images/vd2.png" style="float: left; width: 30%; margin-right: 1%; margin-bottom: 0.5em;"></a><a href="https://youtu.be/hIZ36ws0XPs" target="_blank"><img src="images/vd3.png" style="float: left; width: 30%; margin-right: 1%; margin-bottom: 0.5em;"></a>     

&nbsp;    

## Pre-requisites 

This code repo is sufficient to accomplish the above 3 steps. However, if you are new to using Python for the above tasks, it is recommended that you go through the step-by-step instructions in the above listed videos.

### Set-Up 

You need to complete the set-up listed here. 

| Tool                 | Set-up Steps                                                                                                                                       |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| ElephantSQL          | Create the config_esql.py file using the config_esql_template.py file This has your credentials to connect to the ElephantSQL cloud database     |
| Imagga               | Create the config_imagga.py file using the config_imagga_template.py file This has your credentials to connect to the Imagga Computer Vision API |
| Package Installation | Install the Python packages required using the requirements.txt file                                                                               |

To install the Python packages use: 

```
pip install -r requirements.txt
```

### CREATE the database table 

We need to create a table in the ElephantSQL database to store the image tags. 

For this we will use the 'create_drop_tables.py' file. 

To run the code, go to the Terminal (Mac) or Command prompt (Win). Change to the 'esql_db' directory and run the code as shown:

```
python create_drop_tables.py --sqlfile='table_creation1.sql'
```
This will create the 'image_tags' table in the database. 


## Running the Code 


Run the main.py file as shown below. 

```
python main.py --image='images/afg-1960s.jpg' 
```

This will generate the imagga tags using the API and then store the results in the database table 'image_tags' that we created earlier. 

## Code Walkthrough 

The main.py file uses the following functions: 

- 'upload_imagga' - Uplaod the image to the imagga server
- 'tag_imagga' to generate the image tags 
- 'delete_imagga' - Delete the image from the imagga server
- 'read_insert_data_into_tables' to insert the generated tags into the ElephantSQL database table 'image_tags'


